name: Check seed data generators

on:
  pull_request:

jobs:
  check_seed_data_generators:
    name: Check seed data generators
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - uses: actions/setup-node@v4
        with:
          node-version: '18.19.0'

      - name: Setup caching for node_modules
        uses: actions/cache@v4
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-modules-${{ hashFiles('**/yarn.lock') }}

      - name: Start e2e env
        uses: HSLdevcom/jore4-tools/github-actions/setup-e2e-environment@setup-e2e-environment-v4
        with:
          custom_docker_compose: ./docker/docker-compose.custom.yml

      - name: Install node_modules
        # making sure that we do have the proper set of node_modules installed regardless of what's cached
        run: yarn install --frozen-lockfile

      - name: Build test-db-manager
        run: yarn ws:db build

        # Verify that the seed data generators succeed without errors, no further testing for now
        # Only running timetables seed, because stop registry seed requires routes DB to be populated as well.
      - name: Insert seed data
        run: yarn ws:db seed:timetables
